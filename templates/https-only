
# HTTPS server
#
server {
    listen 443;
    server_name localhost;
    server_tokens off;

    root html;
    index index.html index.htm;

    include /etc/nginx/harden-nginx-https;
    ssl_certificate {{ ssl_dir }}/{{ ansible_fqdn }}.crt;
    ssl_certificate_key {{ ssl_privatedir }}/{{ ansible_fqdn }}.key;

    add_header Strict-Transport-Security "max-age=63072000; includeSubdomains; preload";
    add_header X-Frame-Options SAMEORIGIN;
#    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
#    add_header Content-Security-Policy "default-src self"

## sensitive get/no logging: http://stackoverflow.com/questions/19265766/how-to-not-log-a-get-request-parameter-in-the-nginx-access-logs

## Note cookie are selective and must update $cookie_COOKIE to $cookie_target
## FIXME! log_format must be in https
#    log_format combined_long '$remote_addr - $remote_user [$time_local]  '
#                    '"$request" $status $body_bytes_sent '
#                    '"$http_referer" "$http_user_agent" "$cookie_COOKIE"';
#    access_log /var/log/nginx/access-long.log combined_long;

    keepalive_timeout   70;

    include /etc/nginx/harden-nginx-common;


    location / {
        root /usr/share/nginx/html;
{% if hardenwebserver_nginx_debian_pkg is defined and hardenwebserver_nginx_debian_pkg == 'nginx-naxsi' and hardenwebserver_nginx_naxsi is defined and hardenwebserver_nginx_naxsi %}
            include /etc/nginx/naxsi.rules;
{% endif %}
{% if hardenwebserver_nginx_with_fastcgi is defined and hardenwebserver_nginx_with_fastcgi %}
#            include /etc/nginx/harden-nginx-fastcgi_params;
{% endif %}

        }
        
}
