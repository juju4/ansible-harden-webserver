## HTTPS common server/virtualhost settings

ssl on;
#ssl_certificate {{ ssl_dir }}/{{ ansible_fqdn }}.crt;
#ssl_certificate_key {{ ssl_privatedir }}/{{ ansible_fqdn }}.key;

ssl_session_cache   shared:SSL:10m;
ssl_session_timeout 10m;

ssl_protocols TLSv1.2;
ssl_prefer_server_ciphers on;
## https://cipherli.st/
ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
ssl_ecdh_curve secp384r1; # Requires nginx >= 1.1.0
ssl_session_cache shared:SSL:10m;
{% if hardenwebserver_nginx_sessiontickets is defined and not hardenwebserver_nginx_sessiontickets %}
ssl_session_tickets off; # Requires nginx >= 1.5.9
{% endif %}
{% if hardenwebserver_nginx_stapling is defined and hardenwebserver_nginx_stapling %}
ssl_stapling on; # Requires nginx >= 1.3.7
ssl_stapling_verify on; # Requires nginx => 1.3.7
{% endif %}
{% if hardenwebserver_nginx_resolver is defined %}
resolver {{ hardenwebserver_nginx_resolver }} valid=300s;
{% endif %}
resolver_timeout 5s;

## anonymize data? need nginx recompile --with-http_perl_module
## https://sysadminosaurus.blogspot.fr/2014/12/pci-dss-nginx-access-logs-and-credit.html

